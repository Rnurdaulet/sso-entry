<!DOCTYPE html>
<html>
<head>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/jwt-decode@3.1.2/build/jwt-decode.min.js"></script>
</head>
<body>
  <div class="max-w-md mx-auto mt-20">
    <h1 class="text-xl font-bold mb-4 text-center">Вход по ИИН</h1>
    <input id="username" class="w-full border p-2 mb-2" placeholder="ИИН">
    <input id="password" type="password" class="w-full border p-2 mb-4" placeholder="Пароль">
    <button onclick="login()" class="bg-blue-500 text-white p-2 w-full">Войти</button>
    <div id="status" class="mt-4 text-center text-sm text-red-600"></div>
  </div>

  <script>
    async function login() {
      const username = document.getElementById("username").value
      const password = document.getElementById("password").value

      const resp = await fetch("/api/login/password", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          username,
          password,
          client_id: "{{ client_id }}",  // можешь вставить через контекст
          redirect_uri: "{{ redirect_uri }}",
          state: "{{ state }}",
        })
      })

      const data = await resp.json()
      if (data.redirect_url) {
        window.location.href = data.redirect_url
      } else {
        document.getElementById("status").innerText = data.error || "Ошибка"
      }
    }
  </script>
</body>
</html>
